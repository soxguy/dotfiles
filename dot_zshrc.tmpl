# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH
export PATH="/home/dawheat/.local/bin:$PATH"

# Add Snap to path
export PATH="/snap/bin:$PATH"


# Bitwarden helper
bwunlock() {
    if [ -n "$BW_SESSION" ]; then
        echo "Bitwarden already unlocked"
        return 0
    fi
    
    BW_STATUS=$(bw status 2>/dev/null | jq -r '.status')
    
    if [ "$BW_STATUS" = "unauthenticated" ]; then
        echo "Logging in to Bitwarden..."
        bw login
        BW_STATUS=$(bw status | jq -r '.status')
    fi
    
    if [ "$BW_STATUS" = "locked" ]; then
        echo "Unlocking Bitwarden vault..."
        export BW_SESSION=$(bw unlock --raw)
    fi
}

# Wrapper for chezmoi that ensures Bitwarden is unlocked
chezmoi() {
    case "$1" in
        apply|update|init)
            bwunlock
            ;;
    esac
    command chezmoi "$@"
}

# Offer to unlock Bitwarden on shell startup
if [ -z "$BW_SESSION" ]; then
    BW_STATUS=$(bw status 2>/dev/null | jq -r '.status')

    if [ "$BW_STATUS" = "locked" ] || [ "$BW_STATUS" = "unauthenticated" ]; then
        echo -n "Bitwarden is locked. Unlock now? (Y/n): "
        read -r response
        if [[ ! "$response" =~ ^[Nn]$ ]]; then
            bwunlock
        fi
    fi
fi


alias bat='batcat'
alias cat='batcat'

alias l='exa --icons --group-directories-first --git --header'
alias ls='exa --icons --group-directories-first --git --header -1'
alias ll='exa --icons --group-directories-first --git --long --header'
alias la='exa --icons --group-directories-first --git --long --all --header'

alias cdr='cd ~/repos'


#if [ -z "$SSH_AUTH_SOCK" ]; then
#   # Check for a currently running instance of the agent
#   RUNNING_AGENT="`ps -ax | grep 'ssh-agent -s' | grep -v grep | wc -l | tr -d '[:space:]'`"
#   if [ "$RUNNING_AGENT" = "0" ]; then
#        # Launch a new instance of the agent
#        ssh-agent -s &> $HOME/.ssh/ssh-agent
#   fi
#   eval `cat $HOME/.ssh/ssh-agent`
#   ssh-add ~/.ssh/id_ed25519
#fi

#eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

# Add environment variables from BitWarden (loops through all fields in the item)
{{- range $key, $field := (bitwardenFields "item" "API Keys - zsh ENV") }}
export {{ $key }}={{ $field.value }}
{{- end }}

# Initialize Starship prompt
eval "$(starship init zsh)"
